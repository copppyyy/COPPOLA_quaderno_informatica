CREATE DATABASE IF NOT EXISTS db_2015;
USE db_2015;

CREATE TABLE IF NOT EXISTS UTENTE (
    Id_Utente INT AUTO_INCREMENT PRIMARY KEY,
    Nickname VARCHAR(50) NOT NULL UNIQUE,
    Nome VARCHAR(50) NOT NULL,
    Cognome VARCHAR(50) NOT NULL,
    Email VARCHAR(100) NOT NULL UNIQUE,
    Newsletter_Attiva BOOLEAN DEFAULT TRUE
);

CREATE TABLE IF NOT EXISTS CATEGORIA (
    Id_Categoria INT AUTO_INCREMENT PRIMARY KEY,
    Nome VARCHAR(100) NOT NULL
);

CREATE TABLE IF NOT EXISTS EVENTO (
    Id_Evento INT AUTO_INCREMENT PRIMARY KEY,
    FK_Id_Categoria INT NOT NULL,
    Titolo VARCHAR(100) NOT NULL,
    Luogo VARCHAR(100) NOT NULL,
    Data DATE NOT NULL,
    Provincia VARCHAR(50) NOT NULL,
    Artisti_Invitati TEXT NOT NULL,  -- Va bene, se ti aspetti un elenco lungo di artisti
    FK_Id_Utente INT NOT NULL,
    FOREIGN KEY (FK_Id_Categoria) REFERENCES CATEGORIA(Id_Categoria) ON DELETE CASCADE,
    FOREIGN KEY (FK_Id_Utente) REFERENCES UTENTE(Id_Utente) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS COMMENTO (
    Id_Commento INT AUTO_INCREMENT PRIMARY KEY,
    FK_Id_Utente INT NOT NULL,
    FK_Id_Evento INT NOT NULL,
    Testo_Commento TEXT NOT NULL,
    Voto INT NOT NULL CHECK (Voto BETWEEN 1 AND 5),  -- Vincolo: il voto deve essere tra 1 e 5
    Data_Commento TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (FK_Id_Utente) REFERENCES UTENTE(Id_Utente) ON DELETE CASCADE,
    FOREIGN KEY (FK_Id_Evento) REFERENCES EVENTO(Id_Evento) ON DELETE CASCADE
);
